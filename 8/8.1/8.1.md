# 8.1. Sentencias SQL por módulo / prototipo

## Módulo 5: Liquidación y cierre de socios
### Requerimento: R501
### Interfaz: I501
<div align="center">
<a>
    <img src="https://github.com/fiis-bd242/bd242-grupo6/blob/main/src/prototipoLIQ1corrF.png?raw=true" alt="Logo" width="750" style=" padding-right: 120px;">
</a>
</div>

#### Sentencias SQL:

Mostrar datos de distribuidor específico.
```sql 
SELECT 
    c.NOMBRE AS nombre_cliente,
    c.CLASE_PERSONA AS clasificacion,
    c.COD_CLIENTE AS codigo,
    c.REGION AS region,
    co.FECHA_FIN_NORMAL AS fecha_fin_normal
FROM 
    Cliente c
JOIN 
    Contrato co ON c.COD_CLIENTE = co.COD_CLIENTE
WHERE 
    co.ESTADO_CONTRATO = 'vigente'    -- Solo contratos vigentes, no los resueltos
	and co.cod_analista_s = '<Analista de soporte que tiene la sesión activa>'
    and c.cod_cliente = '<Código>';
```

Establecer fecha de resolución del contrato
```sql 
UPDATE Contrato
SET FECHA_FIN_REAL = '<Seleccionar fecha de bloqueo>'
WHERE COD_CLIENTE = '<Código>';
```
- **<>Analista de soporte que tiene la sesión activa:** Es el analista de soporte que inició sesión y se muestran solo los contratos vigentes que puede gestionar.
- **<>Código:** Es el código del cliente o distribuidor que es administrado por el analista.
- **<>Seleccionar fecha de bloqueo:** Elegible por el analista de soporte.

### Requerimento: R502
### Interfaz: I502
<div align="center">
<a>
    <img src="https://github.com/fiis-bd242/bd242-grupo6/blob/main/src/prototipoLIQ2corrF.png?raw=true" alt="Logo" width="750" style=" padding-right: 120px;">
</a>
</div>

#### Sentencias SQL:

Mostrar todo el histórico de contratos resueltos al analista de Credito, ordenados descendentemente por fecha.
```sql 

UPDATE Contrato
SET FECHA_FIN_REAL = '<Seleccionar fecha de bloqueo>'
WHERE COD_CLIENTE = '<Código>';


```
Mostrar detalles de la preliquidación al analista de credito
```sql 
select cod_liquidacion as codigo, fecha_emision as fecha_de_emision, fecha_lim_obs as fecha_limite_para_obs,
fecha_finalizacion as fecha_de_finalizacion, monto_deuda_acum as monto_acumulado_de_deuda, monto_comisiones as comisiones,
monto_garantias as garantias
from liquidacion
where tipo_liq = 'pre-liquidacion'
	and cod_analista_ac = 'AC0001'
	and cod_cliente = 'CL00830';
```

Mostrar la liquidacion final al analista de credito
```sql 
select cod_liquidacion as codigo, fecha_emision as fecha_de_emision, fecha_lim_obs as fecha_limite_para_obs,
fecha_finalizacion as fecha_de_finalizacion, monto_deuda_acum as monto_acumulado_de_deuda, monto_comisiones as comisiones,
monto_garantias as garantias
from liquidacion
where tipo_liq = 'liquidacion final'
	and cod_analista_ac = 'AC0001'
	and cod_cliente = 'CL00830';

```

### Requerimento: R503
### Interfaz: I503

<div align="center">
<a>
    <img src="https://github.com/fiis-bd242/bd242-grupo6/blob/main/src/prototipoLIQ3corr.png?raw=true" alt="Logo" width="750" style=" padding-right: 120px;">

</a>
</div>

```sql 

SELECT 
    c.NOMBRE AS Nombre,
    c.REP_LEGAL AS Rep_legal,
    co.FECHA_FIN_REAL AS fecha_fin_real,
    c.ESTADO_CLIENTE AS estado_cliente
FROM 
    Cliente c
JOIN 
    Contrato co ON c.COD_CLIENTE = co.COD_CLIENTE
JOIN 
    Liquidacion l ON l.cod_cliente = co.cod_cliente
WHERE l.COD_ANALISTA_AC = 'Analista de credito con la sesión activa'  -- Código del analista de crédito específico
group by c.nombre, c.rep_legal, co.fecha_fin_real, c.estado_cliente
order by co.fecha_fin_real DESC;
```


Filtros sleeccionables de año, mes y estado del cliente.


```sql 
SELECT 
    c.NOMBRE AS Nombre,
    c.REP_LEGAL AS Rep_legal,
    co.FECHA_FIN_REAL AS fecha_fin_real,
    c.ESTADO_CLIENTE AS estado_cliente
FROM 
    Cliente c
JOIN 
    Contrato co ON c.COD_CLIENTE = co.COD_CLIENTE
JOIN 
    Liquidacion l ON l.cod_cliente = co.cod_cliente
where
	l.COD_ANALISTA_AC = 'AC0001' -- Código del analista de crédito específico
	AND EXTRACT(YEAR FROM co.FECHA_FIN_REAL) = 2024  -- Filtrar por el año de la fecha de resolución
    AND EXTRACT(MONTH FROM co.FECHA_FIN_REAL) = 02  -- Filtrar por el mes de la fecha de resolución sin importar el año (por ejemplo: febrero)
    and c.estado_cliente = 'LIQUIDADO' -- Filtrar por el estado del cliente
group by c.nombre, c.rep_legal, co.fecha_fin_real, c.estado_cliente
order by co.fecha_fin_real DESC;
```





## Módulo 2: Cobranzas
### Requerimento: R201

<div align="center">
<a>
    <img src="https://github.com/fiis-bd242/bd242-grupo6/blob/main/src/COBRANZAS%20PROTOTIPO1.png?raw=true" alt="Logo" width="750" style=" padding-right: 120px;">


#### Sentencias SQL:
<<<<<<< HEAD
Mostrar datos 
```sql 
SELECT 
    c.NOMBRE AS "Nombre",
    c.COD_CLIENTE AS "ID",
    c.REGION AS "Región",
    d.MONTO_DEUDA AS "Monto adeudado",
    d.DIAS_RETRASO AS "Días de atraso",
    d.ESTADO_DEUDA AS "Estado de cuenta",
    'Más detalles' AS "Mas_detalles"
FROM 
    Cliente c
JOIN 
    Deuda d ON c.COD_CLIENTE = d.COD_CLIENTE;

```

Mostrar datos filtraods por region o zona


```sql 
SELECT 
    c.NOMBRE AS "Nombre",
    c.COD_CLIENTE AS "ID",
    c.REGION AS "Región",
    d.MONTO_DEUDA AS "Monto adeudado",
    d.DIAS_RETRASO AS "Días de atraso",
    d.ESTADO_DEUDA AS "Estado de cuenta",
    'Más detalles' AS "Mas_detalles"
FROM 
    Cliente c
JOIN 
    Deuda d ON c.COD_CLIENTE = d.COD_CLIENTE
WHERE 
    c.REGION = 'Callao'; 

```
Mostrar datos filtrado por estado de cuenta

```sql 
SELECT 
    c.NOMBRE AS "Nombre",
    c.COD_CLIENTE AS "ID",
    c.REGION AS "Región",
    d.MONTO_DEUDA AS "Monto adeudado",
    d.DIAS_RETRASO AS "Días de atraso",
    d.ESTADO_DEUDA AS "Estado de cuenta",
    'Más detalles' AS "Mas_detalles"
FROM 
    Cliente c
JOIN 
    Deuda d ON c.COD_CLIENTE = d.COD_CLIENTE
WHERE 
    d.ESTADO_DEUDA = 'Atrasado';


``` 
### Requerimento: R203

<div align="center">
<a>
    <img src="https://github.com/fiis-bd242/bd242-grupo6/raw/main/src/COBRANZAS%20PROTOTIPO2.png?raw=true" alt="Logo" width="750" style=" padding-right: 120px;">
</a>
</div>

```sql 
SELECT 
    c.NOMBRE AS "Nombre",
    c.REGION AS "Región/Zona",
    c.TELEFONO AS "Teléfono",
    c.CORREO_EMPRESA AS "Correo electrónico",
    d.FECHA_VENCIMIENTO AS "Fecha de vencimiento",
    d.MONTO_DEUDA AS "Monto adeudado",
    d.ESTADO_DEUDA AS "Estado de cuenta",
    d.ESTADO_COBRANZA AS "Tipo de proceso de cobranza"
FROM 
    Cliente c
JOIN 
    Deuda d ON c.COD_CLIENTE = d.COD_CLIENTE
WHERE 
    c.COD_CLIENTE = 'CODIGO_CLIENTE'; 
``` 

### Requerimento: R204

<div align="center">
<a>
    <img src="https://github.com/fiis-bd242/bd242-grupo6/raw/main/src/COBRANZAS%20PROTOTIPO3.png?raw=true" alt="Logo" width="750" style=" padding-right: 120px;">
</a>
</div>

Mostrar notificaciones 

```sql
SELECT 
    n.FECHA_ENVIO AS "Fecha",
    d.MONTO_DEUDA AS "Monto",
    n.TIPO_NOTIFICACION AS "Actividad realizada",
    d.DIAS_RETRASO AS "Días de atraso",
    a.NOMBRE_ANALISTA_COBRANZA AS "Responsable",
    d.ESTADO_COBRANZA AS "Estado de cobranza",
    d.ESTADO_DEUDA AS "Estado de cuenta"
FROM 
    Notificacion_cobranza n
JOIN 
    Deuda d ON n.COD_DEUDA = d.COD_DEUDA
JOIN 
    Analista_cobranza a ON d.COD_ANALISTA_COBRANZA = a.COD_ANALISTA_COBRANZAS
WHERE 
    n.COD_CLIENTE = 'CL00508'  -- Reemplaza 'CODIGO_CLIENTE' con el código del cliente específico
ORDER BY 
    n.FECHA_ENVIO DESC;


``` 
### Requerimento: R205

<div align="center">
<a>
    <img src="https://github.com/fiis-bd242/bd242-grupo6/raw/main/src/COBRANZAS%20PROTOTIPO4.png?raw=true" alt="Logo" width="750" style=" padding-right: 120px;">
</a>
</div>

Actualizar el estado de cuenta de un cliente

```sql
UPDATE Deuda
SET 
    ESTADO_DEUDA = 'Al dia',
    DIAS_RETRASO = 0
WHERE 
    COD_CLIENTE = 'CODIGO_CLIENTE'  -- Reemplaza 'CODIGO_CLIENTE' con el código del cliente específico
    AND ESTADO_DEUDA = 'Atrasado';  
``` 
Agregar en el historial de notificaciones la accion realizada

```sql
INSERT INTO Notificacion_cobranza (
    COD_NOTIFICACION_COBRANZA,
    FECHA_ENVIO,
    TIPO_NOTIFICACION,
    COD_CLIENTE,
    COD_DEUDA
)
VALUES (
    'NC02136',       -- Reemplaza con el código único para la notificación
     CURRENT_DATE,             -- Fecha actual
    'Pago realizado',         -- Tipo de notificación
    'CL00508',         -- Código del cliente específico
    'CD00508'            -- Código de la deuda específica que fue pagada
);

``` 




