# 8.1. Sentencias SQL por módulo / prototipo

## Módulo 5: Liquidación y cierre de socios
### Requerimento: R501
### Interfaz: I501
<div align="center">
<a>
    <img src="https://github.com/fiis-bd242/bd242-grupo6/blob/main/src/prototipoLIQ1corrF.png?raw=true" alt="Logo" width="750" style=" padding-right: 120px;">
</a>
</div>

#### Sentencias SQL:

Mostrar datos de distribuidor específico.
```sql 
SELECT 
    c.NOMBRE AS nombre_cliente,
    c.CLASE_PERSONA AS clasificacion,
    c.COD_CLIENTE AS codigo,
    c.REGION AS region,
    co.FECHA_FIN_NORMAL AS fecha_fin_normal
FROM 
    Cliente c
JOIN 
    Contrato co ON c.COD_CLIENTE = co.COD_CLIENTE
WHERE 
    co.ESTADO_CONTRATO = 'vigente'    -- Solo contratos vigentes, no los resueltos
	and co.cod_analista_s = '<Analista de soporte que tiene la sesión activa>'
    and c.cod_cliente = '<Código>';
```

Establecer fecha de resolución del contrato
```sql 
UPDATE Contrato
SET FECHA_FIN_REAL = '<Seleccionar fecha de bloqueo>'
WHERE COD_CLIENTE = '<Código>';
```
- **<>Analista de soporte que tiene la sesión activa:** Es el analista de soporte que inició sesión y se muestran solo los contratos vigentes que puede gestionar.
- **<>Código:** Es el código del cliente o distribuidor que es administrado por el analista.
- **<>Seleccionar fecha de bloqueo:** Elegible por el analista de soporte.

### Requerimento: R502
### Interfaz: I502
<div align="center">
<a>
    <img src="https://github.com/fiis-bd242/bd242-grupo6/blob/main/src/prototipoLIQ2corrF.png?raw=true" alt="Logo" width="750" style=" padding-right: 120px;">
</a>
</div>

#### Sentencias SQL:

Mostrar todo el histórico de contratos resueltos al analista de Credito, ordenados descendentemente por fecha.
```sql 
SELECT 
    c.NOMBRE AS Nombre,
    c.REP_LEGAL AS Rep_legal,
    co.FECHA_FIN_REAL AS fecha_fin_real,
    c.ESTADO_CLIENTE AS estado_cliente
FROM 
    Cliente c
JOIN 
    Contrato co ON c.COD_CLIENTE = co.COD_CLIENTE
JOIN 
    Liquidacion l ON l.cod_cliente = co.cod_cliente
WHERE l.COD_ANALISTA_AC = 'Analista de credito con la sesión activa'  -- Código del analista de crédito específico
group by c.nombre, c.rep_legal, co.fecha_fin_real, c.estado_cliente
order by co.fecha_fin_real DESC;
```
Filtros sleeccionables de año, mes y estado del cliente.
```sql 
SELECT 
    c.NOMBRE AS Nombre,
    c.REP_LEGAL AS Rep_legal,
    co.FECHA_FIN_REAL AS fecha_fin_real,
    c.ESTADO_CLIENTE AS estado_cliente
FROM 
    Cliente c
JOIN 
    Contrato co ON c.COD_CLIENTE = co.COD_CLIENTE
JOIN 
    Liquidacion l ON l.cod_cliente = co.cod_cliente
where
	l.COD_ANALISTA_AC = 'AC0001' -- Código del analista de crédito específico
	AND EXTRACT(YEAR FROM co.FECHA_FIN_REAL) = 2024  -- Filtrar por el año de la fecha de resolución
    AND EXTRACT(MONTH FROM co.FECHA_FIN_REAL) = 02  -- Filtrar por el mes de la fecha de resolución sin importar el año (por ejemplo: febrero)
    and c.estado_cliente = 'LIQUIDADO' -- Filtrar por el estado del cliente
group by c.nombre, c.rep_legal, co.fecha_fin_real, c.estado_cliente
order by co.fecha_fin_real DESC;
```

### Requerimento: R502
### Interfaz: I502
<div align="center">
<a>
    <img src="https://github.com/fiis-bd242/bd242-grupo6/blob/main/src/prototipoLIQ3corr.png?raw=true" alt="Logo" width="750" style=" padding-right: 120px;">
</a>
</div>

#### Sentencias SQL:

Mostrar detalles de la preliquidación al analista de credito
```sql 
select cod_liquidacion as codigo, fecha_emision as fecha_de_emision, fecha_lim_obs as fecha_limite_para_obs,
fecha_finalizacion as fecha_de_finalizacion, monto_deuda_acum as monto_acumulado_de_deuda, monto_comisiones as comisiones,
monto_garantias as garantias
from liquidacion
where tipo_liq = 'pre-liquidacion'
	and cod_analista_ac = 'AC0001'
	and cod_cliente = 'CL00830';
```

Mostrar la liquidacion final al analista de credito
```sql 
select cod_liquidacion as codigo, fecha_emision as fecha_de_emision, fecha_lim_obs as fecha_limite_para_obs,
fecha_finalizacion as fecha_de_finalizacion, monto_deuda_acum as monto_acumulado_de_deuda, monto_comisiones as comisiones,
monto_garantias as garantias
from liquidacion
where tipo_liq = 'liquidacion final'
	and cod_analista_ac = 'AC0001'
	and cod_cliente = 'CL00830';
```