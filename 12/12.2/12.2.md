## 12.2. Escenario de Uso

### Contexto y Requerimiento

En el sistema de gestión de solicitudes, los usuarios pueden cargar documentos que se asocian a cada solicitud mediante formularios interactivos. Estos documentos son de vital importancia para el proceso de validación y aprobación de solicitudes. Para mejorar el rendimiento y la escalabilidad del sistema, se ha optado por almacenar estos archivos en **Couchbase** en lugar de la base de datos SQLite tradicional. Couchbase proporciona ventajas significativas al manejar grandes volúmenes de archivos binarios, permitiendo una mayor flexibilidad en la gestión de documentos, así como una mejor integración con otros sistemas distribuidos.

### Proceso de Carga y Almacenamiento de Archivos

1. **Subida de Archivos**: 
   - Los usuarios suben archivos mediante un formulario que incluye un campo de carga de archivos.
   - Si el archivo es válido, se guarda en Couchbase en forma de documento binario. Cada archivo se asocia a una solicitud mediante un identificador único (`cod_documento`), lo que permite su acceso y referencia rápida.
   - Los archivos se almacenan junto con su tipo MIME y una fecha de subida en formato ISO para facilitar su manejo y organización dentro de la base de datos.

2. **Actualización de Archivos**:
   - Si un archivo ya existe en Couchbase para una solicitud específica, el sistema permite reemplazarlo con un nuevo archivo.
   - El nuevo archivo se sube y reemplaza al anterior en Couchbase, asegurando que siempre se conserve la versión más reciente del archivo.

3. **Eliminación de Archivos**:
   - Si un archivo ya no es necesario (por ejemplo, cuando un documento es eliminado de la solicitud), el sistema verifica si el archivo existe en Couchbase.
   - Si el archivo existe, se elimina de la base de datos, asegurando que no haya datos innecesarios o redundantes en el sistema.
   - Si el archivo no se encuentra en Couchbase, el sistema simplemente continúa con la operación sin generar errores, manteniendo la integridad del flujo de trabajo.

### Ventajas de Usar Couchbase

- **Escalabilidad**: Couchbase permite el manejo eficiente de grandes volúmenes de archivos binarios, lo que es crucial para aplicaciones con alto tráfico de documentos.
- **Flexibilidad**: Almacenando los archivos en Couchbase, el sistema no está limitado por las restricciones de tamaño de archivos que podría imponer una base de datos relacional como SQLite.
- **Rendimiento Mejorado**: La naturaleza distribuida de Couchbase mejora el acceso a los documentos y su disponibilidad en sistemas de gran escala, lo que resulta en tiempos de respuesta más rápidos al interactuar con los archivos.
- **Manejo Sencillo de Archivos**: Al integrar Couchbase, el sistema puede realizar fácilmente operaciones de actualización y eliminación de archivos sin comprometer el rendimiento general del sistema.

### Ejemplo de Flujo de Trabajo

1. Un usuario completa el formulario de solicitud y adjunta un archivo en el formulario.
2. El sistema verifica si el archivo ya existe para la solicitud. Si existe, el archivo se reemplaza con el nuevo. Si no existe, el archivo se guarda como un nuevo documento en Couchbase.
3. Si en el futuro se necesita eliminar el archivo, el sistema verifica su existencia en Couchbase y, si lo encuentra, lo elimina.
4. Todo el proceso se lleva a cabo de manera eficiente y sin impacto negativo en la experiencia del usuario, garantizando una gestión adecuada de los archivos asociados a las solicitudes.
